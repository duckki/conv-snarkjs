# `snarkjs` verifier contract converter from Solidity to Python

This tool converts an existing snarkjs-generated Solidity zk-SNARK verifier into an equivalent Python code that can be executed more conveniently within Python environment.

## Setup

### Prerequisites

- Python3
- pipenv

### Installing Python dependencies

Run the following command:
```
$ pipenv install
```

`py-ecc` and `antlr4-python3-runtime` packages are needed.


## Usage

```
$ pipenv run python3 extractor/extractor.py <input.sol> <output.py>
```

`input.sol` must be a snarkjs-generated Solidity source file. Currently, Groth16 is supported.

Try the included sample contract:
```
$ pipenv run python3 extractor/extractor.py extractor/tests/sample.sol output.py
```

## Output

The Python output file will contain a very succint code that verifies groth16 proofs.

Example:
```python
alpha = G1Point( 20491192805390485299153009773594534940189261866228447918068658471970481763042, 9383485363053290200918347156157836566562967994039712273449902621266178545958 )
beta = G2Point( [ 4252822878758300859123897981450591353533073413197771768651442665752259397132, 6375614351688725206403948262868962793625744043794305715222011528459656738731 ]
              , [ 21847035105528745403288232691147584728191162732299865338377159692350059136679, 10505242626370262277552901082094356697409835680220590971873171140371331206856 ] )
gamma = G2Point( [ 11559732032986387107991004021392285783925812861821192530917403151452391805634, 10857046999023057135944570762232829481370756359578518086990519993285655852781 ]
               , [ 4082367875863433681332203403145435568316851327593401208105741076214120093531, 8495653923123431417604973247489272438418190587263600148770280649306958101930 ] )
delta = G2Point( [ 17096891768136499985262733314739463401483667921622994906401545195305800975495, 17439231704024250219075436644712307158019721615967763120340393268595545870567 ]
               , [ 14242227101522867103124176999663903173398471163652444459509115469646714142182, 15092398166611519871664689356368494634061807894631742303838343043671627223964 ] )
IC0 = G1Point( 6819801395408938350212900248749732364821477541620635511814266536599629892365, 9092252330033992554755034971584864587974280972948086568597554018278609861372 )
IC1 = G1Point( 17882351432929302592725330552407222299541667716607588771282887857165175611387, 18907419617206324833977586007131055763810739835484972981819026406579664278293 )

def verifyProof( A, B, C, pubSignals ) -> bool:
    Vk = IC0 + IC1 * pubSignals[0]
    return e(-A, B) * e(alpha, beta) * e(Vk, gamma) * e(C, delta) == GT_one
```

The output Python code also includes a simple REPL script that verifies user inputs intereactively. It can be executed as following:

```
$ pipenv run python3 <output.py>
```

The `verifyProof>` prompt expects a Remix-style function call parameter experessions. You can use the output generated from the `snarkjs generatecall` command. For example,

```
verifyProof> ["0x1b3ae6c8291dfe7cb805cba4a6d96c7f756f01454d390515d472953f05d31a13", "0x0859d0229e3c755fb68bc295ec29eea406fe750dfee227cb1a552c95b3798699"],[ ["0x1595e9e550733dd3e9b55e17fb281ee5cec2afb3dca1f9e664cfc15136d735ed", "0x2bfe6599ed5a23f12bbeb3a68f7425219fbfef33f029c1e7a1b3ea6859c69d84"],["0x1aa2cddbeb6687acb2cbb6c9a37c6c511fbb6888a28fa3afd7e70d1700816a9e", "0x2fd7c0c3162718a685203844fd051939338b9a663e224afef4530b73fa5248d0"] ],["0x0f84a2484d2aa78e6b9d40e851d8851d9f52f0cec19ef1adc1109d7d99c6e361", "0x2df1c9244551210bc3f01ffcb65cd1fc162fc87fcd389a1160ada5096fd0afd4"],["0x0000000000000000000000000000000000000000000000000000000000000021"]
```

If `py-ecc` package is installed in system-wide, the `<ouptut.py>` can be executed without running `pipenv`. However, the output Python code depends on the `snark` and `ethereum` subdirectories of this project. So, make sure they are included in the python module search paths.
